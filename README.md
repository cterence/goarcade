# goarcade

An arcade game emulator based on the Intel 8080 CPU, written in Golang. It can play classic arcade games like [1978 Space Invaders](https://en.wikipedia.org/wiki/Space_Invaders).

![space-invaders gif](./docs/space-invaders.gif)

- Passes common 8080 CPU tests
- Timing accurate (CPU @ 2MHz, UI @ 60Hz)
- Performance optimized, uses <10% of a CPU core (tested on a Ryzen 5 2600 CPU) when running at 2MHz
- SDL3 UI without needing CGo using [zyko0/go-sdl3](https://github.com/Zyko0/go-sdl3)
- Comprehensive CLI interface
- Audio support (numbered WAV files: 0.wav, 1.wav...)
- Pause, reset, save states

TODO:

- [ ] Read MAME .zip archives
- [ ] Game name in save state file name
- [ ] Help screen to show controls
- [ ] Code for supporting other games (sound file mappings, i/o, memory mappings)

## Usage

No game ROM included, do your own research :)

```bash
# Download dependencies
> go mod download

# Build emulator
> go build

# Help
> ./goarcade --help
NAME:
   goarcade - Intel 8080 arcade emulator

USAGE:
   goarcade [global options] [command [command options]] [ordered rom part paths]

COMMANDS:
   dasm, d  disassemble a program
   help, h  Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --pprof, -p                    run pprof webserver on localhost:6060
   --state string                 save state file
   --debug, -d                    print debug logs
   --headless                     run without UI window
   --sound-dir string, -s string  directory path for WAV sound files
   --no-audio                     run without audio
   --cpm                          run in CP/M compatibility mode (for CPU tests)
   --unthrottle, -u               do not throttle cpu at 2MHz
   --help, -h                     show help

# Example: running space-invaders with sound
./goarcade --sound-dir ./roms/invaders/sounds ./roms/invaders/invaders.h ./roms/invaders/invaders.g ./roms/invaders/invaders.f ./roms/invaders/invaders.e
```

## Controls

- `c`: add a coin
- `1`: 1 player
- `2`: 2 players
- `a`: p1 left
- `d`: p1 right
- `w`: p1 shoot
- `left arrow`: p2 left
- `right arrow`: p2 right
- `up arrow`: p2 shoot
- `p`: pause
- `r`: reset
- `0`: save state
- `9`: load state

## Test results

Test outputs below are directly generated by a [GitHub workflow](https://github.com/cterence/goarcade/actions/workflows/golang-integration.yaml).

<!-- TEST_OUTPUT_START -->
<!-- TEST_OUTPUT_END -->

[Source for the tests](https://github.com/superzazu/8080/tree/274ffd700b81baabea99b0963bc1260b67132185/cpu_tests)

## Profiling

- Use the `-p` flag to start the profiling webserver

  ```bash
  ./goarcade -p [...]
  ```

- In another shell, use `go tool pprof` to start profiling

  ```bash
  go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30
  ```

- Use `top`, `web` or `png` commands in the repl to explore the results

## References

- [8080 Datasheet](https://deramp.com/downloads/intel/8080%20Data%20Sheet.pdf)
- [Pastraiser's 8080 opcode table](https://pastraiser.com/cpu/i8080/i8080_opcodes.html)
- [superzazu/8080 emulator](https://github.com/superzazu/8080)
- [Computer Archeology](https://www.computerarcheology.com/Arcade/SpaceInvaders/Hardware.html)
- [emulator101.com](https://web.archive.org/web/20240118230905/http://www.emulator101.com/welcome.html) (via web.archive.org)
